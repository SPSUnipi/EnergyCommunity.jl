<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · EnergyCommunity.jl</title><meta name="title" content="Manual · EnergyCommunity.jl"/><meta property="og:title" content="Manual · EnergyCommunity.jl"/><meta property="twitter:title" content="Manual · EnergyCommunity.jl"/><meta name="description" content="Documentation for EnergyCommunity.jl."/><meta property="og:description" content="Documentation for EnergyCommunity.jl."/><meta property="twitter:description" content="Documentation for EnergyCommunity.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">EnergyCommunity.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><input class="collapse-toggle" id="menuitem-1" type="checkbox"/><label class="tocitem" for="menuitem-1"><span class="docs-label">Introduction</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../installation/">Installation guide</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/configurations/">Optimizing different configurations</a></li><li><a class="tocitem" href="../examples/plotting/">Plotting</a></li><li><a class="tocitem" href="../examples/io/">Input/Ouput to/from disk</a></li><li><a class="tocitem" href="../examples/electric_vehicle/">Electric Vehicle</a></li><li><a class="tocitem" href="../examples/heating_cooling/">Heating and Cooling Flexibility</a></li><li><a class="tocitem" href="../examples/theory_of_games/">Fair reward allocations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Optimization Model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../model/intro_model/">Architecture of the model</a></li><li><a class="tocitem" href="../model/power_model/">User power model</a></li><li><a class="tocitem" href="../model/energy_model/">User energy model</a></li><li><a class="tocitem" href="../model/community_model/">Community Shared Energy and benefits</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Fair reward allocations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../theory_of_games/fair_allocation/">Fair benefit allocation</a></li><li><a class="tocitem" href="../theory_of_games/supported_allocations/">Supported fair allocation methods</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Configuration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../configuration/configuration/">Configuration</a></li><li><a class="tocitem" href="../configuration/general/"><code>general</code> Section</a></li><li><a class="tocitem" href="../configuration/market/"><code>market</code> Section</a></li><li><a class="tocitem" href="../configuration/users/"><code>users</code> Section</a></li><li><a class="tocitem" href="../configuration/assets/">Asset types</a></li></ul></li><li><a class="tocitem" href="../API reference/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SPSUnipi/EnergyCommunity.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SPSUnipi/EnergyCommunity.jl/blob/main/docs/src/manual.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h1><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">using JuMP, BilevelJuMP, Cbc

model = BilevelModel(Cbc.Optimizer, mode = BilevelJuMP.SOS1Mode())

@variable(Lower(model), x)
@variable(Upper(model), y)

@objective(Upper(model), Min, 3x + y)
@constraints(Upper(model), begin
    x &lt;= 5
    y &lt;= 8
    y &gt;= 0
end)

@objective(Lower(model), Min, -x)
@constraints(Lower(model), begin
     x +  y &lt;= 8
    4x +  y &gt;= 8
    2x +  y &lt;= 13
    2x - 7y &lt;= 0
end)

optimize!(model)

objective_value(model) # = 3 * (3.5 * 8/15) + 8/15 # = 6.13...
value(x) # = 3.5 * 8/15 # = 1.86...
value(y) # = 8/15 # = 0.53...</code></pre><p>The option <code>BilevelJuMP.SOS1Mode()</code> indicates that the solution method used will be a KKT reformulation emplying SOS1 to model complementarity constraints and solve the problem with MIP solvers (Cbc, Xpress, Gurobi, CPLEX, SCIP).</p><p>Alternatively, the option <code>BilevelJuMP.IndicatorMode()</code> is almost equivalent to the previous. The main difference is that it relies on Indicator constraints instead. This kind of constraints is available in some MIP solvers.</p><p>A third and classic option it the <code>BilevelJuMP.FortunyAmatMcCarlMode()</code>, which relies on the Fortuny-Amat and McCarl big-M method that requires a MIP solver with very basic functionality, i.e., just binary variables are needed. The main drawback of this method is that one must provide bounds for all primal and dual variables. However, if the bounds are good, this method can be more efficient than the previous. Bound hints to compute the big-Ms can be passed with the methods: <code>set_primal_(upper\lower)_bound_hint(variable, bound)</code>, for primals; and <code>set_dual_(upper\lower)_bound_hint(constraint, bound)</code> for duals. We can also call <code>FortunyAmatMcCarlMode(primal_big_M = vp, dual_big_M = vd)</code>, where <code>vp</code> and <code>vd</code> are, repspectively, the big M fallback values for primal and dual variables, these are used when some variables have no given bounds, otherwise the given bounds are used instead.</p><p>Another option is <code>BilevelJuMP.ProductMode()</code> that reformulates the complementarity constraints as products so that the problem can be solved by NLP (Ipopt, KNITRO) solvers or even MIP solvers with the aid of binary expansions (see <a href="https://github.com/joaquimg/QuadraticToBinary.jl">QuadraticToBinary.jl</a>). Note that binary expansions require variables to have upper and lower bounds.</p><p>Finally, one can use <code>BilevelJuMP.MixedMode(default = mode)</code> where <code>mode</code> is one of the other modes described above. With this method it is possible to set complementarity reformulations per constraint with <code>BilevelJuMP.set_mode(ctr, mode)</code>.</p><p>An alternative to complementarity constraint reformulation is the Strong Duality reformulation which add the constraint enforcing primal dual equality. The option is <code>BilevelJuMP.StrongDualityMode(eps)</code> where <code>eps</code> is the tolance on the enforcing constraint.</p><h3 id="Note-on-[QuadraticToBinary.jl](https://github.com/joaquimg/QuadraticToBinary.jl)"><a class="docs-heading-anchor" href="#Note-on-[QuadraticToBinary.jl](https://github.com/joaquimg/QuadraticToBinary.jl)">Note on <a href="https://github.com/joaquimg/QuadraticToBinary.jl">QuadraticToBinary.jl</a></a><a id="Note-on-[QuadraticToBinary.jl](https://github.com/joaquimg/QuadraticToBinary.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Note-on-[QuadraticToBinary.jl](https://github.com/joaquimg/QuadraticToBinary.jl)" title="Permalink"></a></h3><p><a href="https://github.com/joaquimg/QuadraticToBinary.jl">QuadraticToBinary.jl</a> is a package that converts quadratic terms in constraints and objective. To do so the pack acts like a solver on top of the real solver and most data is forwarded directly to the solver itself. For many solvers it is enough to use:</p><pre><code class="language-julia hljs">SOLVER = Xpress.Optimizer()
Q_SOLVER = QuadraticToBinary.Optimizer{Float64}(SOLVER)
BilevelModel(Q_SOLVER, mode = BilevelJuMP.ProductMode(1e-5))</code></pre><p>However, this might lead to some solver not supporting certain functionality like Cbc. In this case we need to:</p><pre><code class="language-julia hljs">SOLVER = Cbc.Optimizer()
CACHED_SOLVER = MOI.Utilities.CachingOptimizer(
    MOI.Utilities.UniversalFallback(MOI.Utilities.Model{Float64}()), SOLVER)
Q_SOLVER = QuadraticToBinary.Optimizer{Float64}(CACHED_SOLVER)
BilevelModel(()-&gt;Q_SOLVER, mode = BilevelJuMP.ProductMode(1e-5))</code></pre><p>Note that we used <code>()-&gt;Q_SOLVER</code> instead of just <code>Q_SOLVER</code> because <code>BilevelModel</code> requires as constructor and not an instance of an object.</p><h2 id="Advanced-Features"><a class="docs-heading-anchor" href="#Advanced-Features">Advanced Features</a><a id="Advanced-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Features" title="Permalink"></a></h2><h3 id="Lower-level-dual-variables"><a class="docs-heading-anchor" href="#Lower-level-dual-variables">Lower level dual variables</a><a id="Lower-level-dual-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Lower-level-dual-variables" title="Permalink"></a></h3><p>Suppose you have a constraint <code>b</code> in the lower level:</p><pre><code class="language-julia hljs">@constraint(Lower(model), b, ...)</code></pre><p>It is possible to access the dual variable of <code>b</code> to use it in the upper level:</p><pre><code class="language-julia hljs">@variable(Upper(model), lambda, DualOf(b))</code></pre><h3 id="Conic-lower-level"><a class="docs-heading-anchor" href="#Conic-lower-level">Conic lower level</a><a id="Conic-lower-level-1"></a><a class="docs-heading-anchor-permalink" href="#Conic-lower-level" title="Permalink"></a></h3><p>BilevelJuMP allows users to write conic models in the lower level. However, solving this kind of problems is much harder and requires complex solution methods. Mosek&#39;s Conic MIP can be used with the aid of <a href="https://github.com/joaquimg/QuadraticToBinary.jl">QuadraticToBinary.jl</a>.</p><p>It is also possible to solve Second Order Cone constrained models with Ipopt. In this case we need to add a special, non-standard bridge, to Ipopt as follows:</p><pre><code class="language-julia hljs">IPO_OPT = Ipopt.Optimizer(print_level=0)
IPO = MOI.Bridges.Constraint.SOCtoNonConvexQuad{Float64}(IPO_OPT)
BilevelModel(()-&gt;IPO, mode = BilevelJuMP.ProductMode(1e-5))</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 10 December 2025 11:50">Wednesday 10 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
